"use strict";var _ref,_RUNTIME_GLOBALS_GET,config=__RETRY_OPTIONS__,maxRetries=config.max||3,retryCollector={};function findCurrentDomain(n){for(var r,e=null!==(r=config.domain)&&void 0!==r?r:[],i="",t=0;t<e.length;t++)if(-1!==n.indexOf(e[t])){i=e[t];break}return i||window.origin}function findNextDomain(n){var r,e=null!==(r=config.domain)&&void 0!==r?r:[],i=findCurrentDomain(n),t=e.indexOf(i);return e[(t+1)%e.length]||n}var postfixRE=/[?#].*$/;function cleanUrl(n){return n.replace(postfixRE,"")}function getQueryFromUrl(n){var r=n.split("?")[1];return r?"?".concat(r.split("#")[0]):""}function getUrlRetryQuery(n,r){return!0===config.addQuery?""!==r?"".concat(r,"&retry=").concat(n):"?retry=".concat(n):"function"==typeof config.addQuery?config.addQuery({times:n,originalQuery:r}):""}function removeDomainFromUrl(n){var r=n.indexOf("//");if(-1===r&&n.startsWith("/"))return n;var e=r+2,i=n.indexOf("/",e);return n.slice(i)}function getAbsolutePathFromUrl(n){return cleanUrl(removeDomainFromUrl(n))}function getNextRetryUrl(n,r,e){return r+getAbsolutePathFromUrl(e)+getUrlRetryQuery(n,getQueryFromUrl(e))}function getCurrentRetry(n){return retryCollector[n]}function initRetry(n){var r,e,i=originalGetChunkScriptFilename(n),t=__RUNTIME_GLOBALS_PUBLIC_PATH__+i,o=null!==(r=null===(e=config.domain)||void 0===e?void 0:e[0])&&void 0!==r?r:window.origin;return{existRetryTimes:1,nextDomain:o,nextRetryUrl:getNextRetryUrl(1,o,t),originalScriptFilename:i,originalSrcUrl:t}}function nextRetry(n){var r,e=getCurrentRetry(n);if(e){var i=e.originalScriptFilename,t=e.originalSrcUrl,o=e.existRetryTimes+1,_=findNextDomain(e.nextDomain);r={existRetryTimes:o,nextDomain:_,nextRetryUrl:getNextRetryUrl(o,_,t),originalScriptFilename:i,originalSrcUrl:t}}else r=initRetry(n);return retryCollector[n]=r,r}var originalEnsureChunk=__RUNTIME_GLOBALS_ENSURE_CHUNK__,originalGetChunkScriptFilename=__RUNTIME_GLOBALS_GET_CHUNK_SCRIPT_FILENAME__,originalGetCssFilename=null!==(_ref=null!==(_RUNTIME_GLOBALS_GET=__RUNTIME_GLOBALS_GET_MINI_CSS_EXTRACT_FILENAME__)&&void 0!==_RUNTIME_GLOBALS_GET?_RUNTIME_GLOBALS_GET:__RUNTIME_GLOBALS_GET_CSS_FILENAME__)&&void 0!==_ref?_ref:function(){return null},originalLoadScript=__RUNTIME_GLOBALS_LOAD_SCRIPT__;function ensureChunk(n){var r=originalEnsureChunk(n),e=originalGetChunkScriptFilename(n),i=originalGetCssFilename(n);return"undefined"!=typeof window&&(e&&(window.__RB_ASYNC_CHUNKS__[e]=!0),i&&(window.__RB_ASYNC_CHUNKS__[i]=!0)),r.catch((function(r){var e,i=nextRetry(n),t=i.existRetryTimes,o=i.originalSrcUrl,_=i.nextRetryUrl,a=i.nextDomain,u=Boolean(null==r||null===(e=r.message)||void 0===e?void 0:e.includes("CSS chunk")),c=function(n){return{times:n,domain:a,url:_,tagName:u?"link":"script",isAsyncChunk:!0}},l=c(t-1);if(t>maxRetries)throw r.message="Loading chunk ".concat(n," from ").concat(o," failed after ").concat(maxRetries,' retries: "').concat(r.message,'"'),"function"==typeof config.onFail&&config.onFail(l),r;var f=config.test;if(f){if("string"==typeof f){var s=new RegExp(f);f=function(n){return s.test(n)}}if("function"!=typeof f||!f(_))throw r}if(config.domain&&config.domain.length>0&&-1===config.domain.indexOf(a))throw r;return"function"==typeof config.onRetry&&config.onRetry(l),ensureChunk(n).then((function(r){if("function"==typeof config.onSuccess){var e,i=c(t);(null!==(e=getCurrentRetry(n))&&void 0!==e?e:{}).existRetryTimes===t&&config.onSuccess(i)}return r}))}))}function loadScript(n,r,e,i){var t=getCurrentRetry(i);return originalLoadScript(t?t.nextRetryUrl:n,r,e,i)}function registerAsyncChunkRetry(){if("undefined"==typeof window||window.__RB_ASYNC_CHUNKS__||(window.__RB_ASYNC_CHUNKS__={}),"undefined"!=typeof __RUNTIME_GLOBALS_REQUIRE__)try{__RUNTIME_GLOBALS_ENSURE_CHUNK__=ensureChunk,__RUNTIME_GLOBALS_LOAD_SCRIPT__=loadScript}catch(n){console.error("[@rsbuild/plugin-assets-retry] Register async chunk retry runtime failed",n)}}registerAsyncChunkRetry();